<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الاختبار الماسي - أ. سعود الشلوي</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f172a; --accent: #1e293b; --gold: #d4af37;
            --success: #10b981; --danger: #ef4444; --bg: #f8fafc;
        }
        body {
            font-family: 'Tajawal', sans-serif; background: var(--bg);
            margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh;
        }
        .app-container {
            width: 100%; max-width: 800px; background: white; border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #e2e8f0;
        }
        .main-header {
            background: var(--primary); color: white; padding: 30px; text-align: center;
            border-bottom: 5px solid var(--gold);
        }
        .main-header h1 { margin: 0; font-size: 28px; font-weight: 900; }
        .main-header p { margin: 10px 0 0; opacity: 0.8; font-size: 18px; }
        
        .content { padding: 40px; }
        .welcome-box { text-align: center; }
        .input-name {
            width: 100%; max-width: 400px; padding: 18px; border-radius: 12px;
            border: 2px solid #e2e8f0; font-size: 18px; text-align: center;
            margin: 25px 0; font-family: 'Tajawal'; transition: 0.3s;
        }
        .input-name:focus { border-color: var(--gold); outline: none; box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1); }

        .btn-start {
            background: var(--gold); color: #fff; border: none; padding: 18px 50px;
            border-radius: 12px; font-size: 20px; font-weight: 700; cursor: pointer;
            transition: 0.3s; box-shadow: 0 10px 20px rgba(212, 175, 55, 0.3);
        }
        .btn-start:hover { transform: translateY(-2px); box-shadow: 0 15px 25px rgba(212, 175, 55, 0.4); }

        .q-card { display: none; }
        .status-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .progress-track { flex-grow: 1; height: 10px; background: #f1f5f9; border-radius: 20px; margin: 0 15px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--gold), #f59e0b); width: 0%; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .question-text { font-size: 24px; font-weight: 700; color: #1e293b; margin-bottom: 30px; line-height: 1.5; }
        .options-grid { display: grid; gap: 15px; }
        .option-item {
            padding: 20px; border: 2px solid #f1f5f9; border-radius: 16px;
            background: #fff; cursor: pointer; transition: 0.2s; font-size: 19px;
            font-weight: 500; text-align: right; font-family: 'Tajawal'; position: relative;
        }
        .option-item:hover:not(.locked) { border-color: var(--gold); background: #fffcf5; }
        .option-item.correct { background: #ecfdf5; border-color: var(--success); color: #065f46; font-weight: 700; }
        .option-item.wrong { background: #fef2f2; border-color: var(--danger); color: #991b1b; }
        .locked { pointer-events: none; }

        .feedback-area { margin-top: 25px; padding: 20px; border-radius: 12px; display: none; animation: slideUp 0.4s; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .btn-next {
            background: var(--primary); color: white; border: none; padding: 15px 40px;
            border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer;
            margin-top: 20px; display: none; float: left;
        }

        .certificate-wrapper {
            display: none; text-align: center; padding: 20px;
        }
        .cert-frame {
            border: 10px solid var(--primary); padding: 40px; background: white;
            position: relative; background-image: radial-gradient(#f1f5f9 1px, transparent 1px); background-size: 20px 20px;
        }
        .cert-frame h2 { color: var(--gold); font-size: 45px; margin: 0; }
        .student-name { font-size: 35px; color: var(--primary); margin: 25px 0; border-bottom: 3px solid var(--gold); display: inline-block; padding: 0 20px; }
        
        @media print { .btn-next, .btn-start, .no-print { display: none !important; } .app-container { box-shadow: none; border: none; } }
        sub { font-size: 0.6em; vertical-align: sub; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="main-header">
        <h1>ثانوية قرطبة | إدارة تعليم الطائف</h1>
        <p>معد الاختبار الشامل: الأستاذ سعود الشلوي</p>
    </div>

    <div class="content">
        <div id="start-screen" class="welcome-box">
            <h2 style="color: var(--primary); font-size: 24px;">اختبار الكيمياء العضوية الشامل (50 سؤالاً)</h2>
            <p style="color: #64748b;">هذا الاختبار يقيس مهاراتك في التسمية، التفاعلات، والمجموعات الوظيفية.</p>
            <input type="text" id="stu-name-input" class="input-name" placeholder="أدخل اسمك الثلاثي للمتابعة">
            <br>
            <button class="btn-start" onclick="initTest()">بدء التحدي الآن</button>
        </div>

        <div id="quiz-screen" class="q-card">
            <div class="status-bar">
                <span id="counter-text" style="font-weight: 700; color: var(--primary);">السؤال 1 من 50</span>
                <div class="progress-track"><div id="progress-bar" class="progress-fill"></div></div>
                <span id="score-text" style="font-weight: 700; color: var(--success);">الدرجة: 0</span>
            </div>
            
            <div id="q-container">
                <div id="q-text" class="question-text"></div>
                <div id="options-grid" class="options-grid"></div>
            </div>

            <div id="feedback-box" class="feedback-area"></div>
            <button id="next-button" class="btn-next" onclick="handleNext()">السؤال التالي ←</button>
            <div style="clear: both;"></div>
        </div>

        <div id="cert-screen" class="certificate-wrapper">
            <div class="cert-frame">
                <h2>شهادة إنجاز</h2>
                <p style="font-size: 20px;">يشهد الأستاذ <strong>سعود الشلوي</strong> بأن الطالب:</p>
                <div id="cert-stu-name" class="student-name"></div>
                <p style="font-size: 20px;">قد أتم بنجاح اختبار الكيمياء العضوية الشامل بنسبة إتقان:</p>
                <div id="cert-final-score" style="font-size: 40px; font-weight: 900; color: var(--success); margin: 20px 0;"></div>
                <p>بتاريخ: <span id="cert-date"></span></p>
                <div style="margin-top: 30px; display: flex; justify-content: space-between;">
                    <small>ختم ثانوية قرطبة</small>
                    <small>توقيع المعلم</small>
                </div>
            </div>
            <button class="btn-start no-print" style="margin-top:30px; background: var(--primary);" onclick="window.print()">تحميل / طباعة الشهادة</button>
            <button class="btn-start no-print" style="margin-top:10px; background: #64748b; font-size: 14px;" onclick="location.reload()">إعادة المحاولة</button>
        </div>
    </div>
</div>

<script>
    // قاعدة البيانات الأصلية (الإجابة الصحيحة هي الأولى دائماً)
    const rawData = [
        { q: "ما هي الصيغة العامة للألكانات؟", a: ["C<sub>n</sub>H<sub>2n+2</sub>", "C<sub>n</sub>H<sub>2n</sub>", "C<sub>n</sub>H<sub>2n-2</sub>", "C<sub>n</sub>H<sub>n</sub>"] },
        { q: "أي من المركبات التالية يصنف كألكين؟", a: ["C<sub>2</sub>H<sub>4</sub>", "CH<sub>4</sub>", "C<sub>2</sub>H<sub>6</sub>", "C<sub>3</sub>H<sub>8</sub>"] },
        { q: "تفاعل إضافة الهيدروجين إلى الألكين يسمى:", a: ["هدرجة", "هلجنة", "تميؤ", "حذف"] },
        { q: "الرابطة في جزئ الإيثاين هي رابطة تساهمية:", a: ["ثلاثية", "أحادية", "ثنائية", "قطبية"] },
        { q: "لتحويل الألكين إلى ألكان نقوم بعملية:", a: ["إضافة", "استبدال", "حذف", "تكثيف"] },
        { q: "المجموعة الوظيفية لهاليدات الألكيل هي:", a: ["الهالوجين (–X)", "الهيدروكسيل", "الكربونيل", "الأمين"] },
        { q: "المركب CH<sub>3</sub>Cl يسمى:", a: ["كلورو ميثان", "كلورو إيثان", "ميثانول", "ميثانال"] },
        { q: "تفاعل هاليد الألكيل مع NaOH المائي ينتج:", a: ["كحول", "إيثر", "ألكان", "ألكين"] },
        { q: "يصنف الكلوروبنزين كـ:", a: ["هاليد أريل", "هاليد ألكيل", "كحول", "أمين"] },
        { q: "لتحضير الأمينات، نفاعل هاليد الألكيل مع:", a: ["الأمونيا", "الماء", "حمض", "إستر"] },
        { q: "المجموعة الوظيفية للكحولات هي:", a: ["الهيدروكسيل (–OH)", "الإيثر", "الأمين", "الكربونيل"] },
        { q: "الصيغة العامة للإيثرات هي:", a: ["R–O–R", "R–OH", "R–COOH", "R–NH<sub>2</sub>"] },
        { q: "أكسدة الإيثانول التامة تنتج:", a: ["حمض إيثانويك", "إيثانال", "إيثان", "ثاني أكسيد الكربون"] },
        { q: "2-بروبانول يصنف ككحول:", a: ["ثانوي", "أولي", "ثالثي", "عديم الهيدروكسيل"] },
        { q: "يتم تحضير الإيثرات بنزع الماء من:", a: ["جزيئين من الكحول", "حمض وكحول", "جزيئين من الحمض", "أمين وحمض"] },
        { q: "المجموعة الوظيفية للكيتونات هي:", a: ["الكربونيل (–CO–) وسطية", "الهيدروكسيل", "الكربوكسيل", "الأمين"] },
        { q: "المركب CH<sub>3</sub>CHO يسمى:", a: ["إيثانال", "إيثانون", "إيثانول", "حمض إيثانويك"] },
        { q: "أكسدة الألدهيد تؤدي دائماً لتكوين:", a: ["حمض كربوكسيلي", "كحول أولي", "كيتون", "إيثر"] },
        { q: "الصيغة العامة للكيتونات هي:", a: ["R–CO–R", "R–CHO", "R–OH", "R–COOH"] },
        { q: "للكشف عن الألدهيدات نستخدم:", a: ["محلول تولن", "ورقة تباع الشمس", "ماء الجير", "كاشف بندكت"] },
        { q: "المجموعة الوظيفية للأحماض الكربوكسيلية:", a: ["الكربوكسيل (–COOH)", "الهيدروكسيل", "الأمين", "الإستر"] },
        { q: "حمض الميثانويك يسمى أيضاً:", a: ["حمض الفورميك", "حمض الأسيتيك", "حمض الخليك", "حمض البروبيونيك"] },
        { q: "تفاعل الحمض الكربوكسيلي مع الكحول يسمى:", a: ["أسترة", "تصبن", "هدرجة", "هلجنة"] },
        { q: "الصيغة العامة للأحماض الكربوكسيلية هي:", a: ["R–COOH", "R–CHO", "R–OH", "R–NH<sub>2</sub>"] },
        { q: "الأكسدة القوية للكحولات الأولية تنتج:", a: ["حمض كربوكسيلي", "كيتون", "إيثر", "ألكان"] },
        { q: "المجموعة الوظيفية للأمينات هي:", a: ["الأمين (–NH<sub>2</sub>)", "الهيدروكسيل", "الكربونيل", "الإستر"] },
        { q: "الرابطة الببتيدية في البروتينات هي رابطة:", a: ["أميدية", "إيثرية", "إسترية", "أيونية"] },
        { q: "عند تفاعل حمض كربوكسيلي مع أمين ينتج:", a: ["أميد", "إستر", "إيثر", "كحول"] },
        { q: "يصنف الميثان أمين كأمين:", a: ["أولي", "ثانوي", "ثالثي", "رباعي"] },
        { q: "تستخدم الأمينات في صناعة:", a: ["الأصباغ والنايلون", "المطهرات فقط", "المبيدات فقط", "البلاستيك فقط"] },
        { q: "المجموعة الوظيفية للإسترات هي:", a: ["–COOR", "–OH", "–COOH", "–CHO"] },
        { q: "تمتاز الإسترات برائحتها التي تشبه:", a: ["الفواكه والأزهار", "البيض الفاسد", "الكلور", "رائحة نفاذة جداً"] },
        { q: "التحلل المائي للإسترات في وسط حمضي ينتج:", a: ["حمض وكحول", "أمين وحمض", "ألكان وماء", "كيتون وكحول"] },
        { q: "المركب CH<sub>3</sub>COOCH<sub>3</sub> هو:", a: ["إستر", "إيثر", "كحول", "كيتون"] },
        { q: "تفاعل الإستر مع قاعدة قوية لتكوين الصابون يسمى:", a: ["تصبن", "أسترة", "بلمرة", "اختزال"] },
        { q: "أبسط كحول هو:", a: ["ميثانول", "إيثانول", "بروبانول", "بنتانول"] },
        { q: "أبسط كيتون هو:", a: ["بروبانون (أسيتون)", "إيثانون", "بنتانون", "ميثانون"] },
        { q: "يعتبر بولي إيثيلين من أنواع:", a: ["البوليمرات", "المونومرات", "الكحولات", "الإسترات"] },
        { q: "إضافة بروم (Br<sub>2</sub>) إلى الإيثين يسمى:", a: ["هلجنة", "هدرجة", "أكسدة", "حذف"] },
        { q: "نزع الماء من الكحول هو تفاعل:", a: ["حذف", "إضافة", "استبدال", "تكثيف"] },
        { q: "تفاعل الإيثين مع الماء ينتج:", a: ["إيثانول", "إيثان", "حمض إيثانويك", "إيثانال"] },
        { q: "الناتج المشترك لاحتراق الهيدروكربونات:", a: ["CO<sub>2</sub> + H<sub>2</sub>O", "O<sub>2</sub> + H<sub>2</sub>", "N<sub>2</sub> + CO", "C + O<sub>2</sub>"] },
        { q: "اختزال الألدهيدات ينتج عنه:", a: ["كحول أولي", "حمض كربوكسيلي", "كيتون", "إيثر"] },
        { q: "أكسدة الكحول الثانوي تنتج:", a: ["كيتون", "ألدهيد", "حمض", "إيثر"] },
        { q: "يستخدم الميثانال (فورمالدهيد) في:", a: ["حفظ العينات", "الوقود", "التبريد", "صناعة الطعام"] },
        { q: "البوليمرات تتكون من وحدات متكررة تسمى:", a: ["مونومرات", "ألكانات", "إسترات", "أيزومرات"] },
        { q: "تفاعل حمضين أمينيين لتكوين بروتين هو تفاعل:", a: ["تكثيف", "إضافة", "حذف", "هلجنة"] },
        { q: "الرابطة في الإيثرات (C–O–C) تعتبر رابطة:", a: ["تساهمية", "أيونية", "فلزية", "هيدروجينية"] },
        { q: "الألكانات مركبات هيدروكربونية:", a: ["مشبعة", "غير مشبعة", "حلقية دائماً", "عطرية"] },
        { q: "المادة التي تبدأ بها عملية البلمرة تسمى:", a: ["مونومر", "عامل حفاز", "بوليمر", "مذيب"] }
    ];

    let quizData = [];
    let currentIdx = 0;
    let score = 0;
    let studentName = "";

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function initTest() {
        const nameInput = document.getElementById('stu-name-input').value.trim();
        if (nameInput.split(/\s+/).length < 3) {
            alert("⚠️ فضلاً، أدخل اسمك الثلاثي لضمان توثيق النتيجة.");
            return;
        }
        studentName = nameInput;

        // تجهيز الأسئلة وخلط الخيارات
        quizData = rawData.map(item => {
            const correctText = item.a[0];
            const options = [...item.a];
            shuffle(options);
            return {
                q: item.q,
                options: options,
                correct: options.indexOf(correctText)
            };
        });
        
        // خلط ترتيب الأسئلة نفسها
        shuffle(quizData);

        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        loadQuestion();
    }

    function loadQuestion() {
        const qObj = quizData[currentIdx];
        document.getElementById('counter-text').innerText = `السؤال ${currentIdx + 1} من 50`;
        document.getElementById('progress-bar').style.width = ((currentIdx + 1) / 50 * 100) + "%";
        document.getElementById('q-text').innerHTML = qObj.q;
        
        const grid = document.getElementById('options-grid');
        grid.innerHTML = "";
        qObj.options.forEach((opt, i) => {
            const btn = document.createElement('div');
            btn.className = "option-item";
            btn.innerHTML = opt;
            btn.onclick = () => checkAns(i, btn);
            grid.appendChild(btn);
        });

        document.getElementById('feedback-box').style.display = 'none';
        document.getElementById('next-button').style.display = 'none';
    }

    function checkAns(idx, btn) {
        const correctIdx = quizData[currentIdx].correct;
        const items = document.querySelectorAll('.option-item');
        const fb = document.getElementById('feedback-box');
        
        items.forEach(el => el.classList.add('locked'));

        if (idx === correctIdx) {
            score++;
            btn.classList.add('correct');
            fb.innerHTML = "✅ إجابة صحيحة مذهلة!";
            fb.style.background = "#ecfdf5"; fb.style.color = "#065f46";
        } else {
            btn.classList.add('wrong');
            items[correctIdx].classList.add('correct');
            fb.innerHTML = `❌ إجابة خاطئة. الخيار الصحيح موضح بالأخضر.`;
            fb.style.background = "#fef2f2"; fb.style.color = "#991b1b";
        }
        
        fb.style.display = 'block';
        document.getElementById('next-button').style.display = 'block';
        document.getElementById('score-text').innerText = `الدرجة: ${score}`;
    }

    function handleNext() {
        currentIdx++;
        if (currentIdx < 50) {
            loadQuestion();
        } else {
            showFinal();
        }
    }

    function showFinal() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('cert-screen').style.display = 'block';
        document.getElementById('cert-stu-name').innerText = studentName;
        const finalRatio = ((score / 50) * 100).toFixed(1);
        document.getElementById('cert-final-score').innerText = finalRatio + "%";
        document.getElementById('cert-date').innerText = new Date().toLocaleDateString('ar-SA');
    }
</script>

</body>
</html>
